@page "/Student/{studentId}/MakeAppointment"

<div class="alert alert-secondary">
    <h4 class="alert-heading">Schedule an Advising Appointment</h4>
    <hr />
    <ul class="nav navbar-nav dropdown-select">
        <li class="dropdown">
            <div class="dropdown-toggle caret-off p-2" data-toggle="dropdown">
                <span class="chevron-right fa fa-chevron-down"></span>
                <div id="selectedAdvisor" data-id="" class="">
                    <span>Choose an Advisor</span>
                    <span>&nbsp;</span>
                </div>
            </div>
            <div class="alert alert-secondary w-100 dropdown-menu">
                <div class="p-2 dropdown-select mb-1" data-id="100000001" onclick="schedulerSelectAdvisor(this)">
                    <div>John Doe ~ College of Engineering ~ Specialty</div>
                    <div class="text-muted">30 minutes</div>
                </div>
                <div class="p-2 dropdown-select mb-1" data-id="100000001" onclick="schedulerSelectAdvisor(this)">
                    <div>John Doe ~ College of Engineering ~ Specialty</div>
                    <div class="text-muted">30 minutes</div>
                </div>
            </div>
        </li>
    </ul>
</div>

<div id="tabAppointmentContainer">
</div>

<div id="spinnerContainer" class="d-none">
    <partial name="_Spinner" />
</div>

<partial name="_MakeAppointmentTmpl" />

<modal id="schedulerCreateAppointmentModal" title="Schedule Appointment" ok-title="Schedule" on-ok-click="">
    <div class="form-group">
        <div class="alert alert-danger">
            Not Implemented.
        </div>
    </div>
</modal>

@section Scripts {
<script>
    $.views.settings.allowCode(true);
    gStudentId = '@ViewContext.RouteData.Values["studentId"]';

    function schedulerSelectSlot(el) {
        $("#tabAppointmentContainer").html($("#spinnerContainer").html());

        gAdvisorId = $(el).attr("data-id");
        $("#selectedAdvisor").attr("data-id", gAdvisorId);
        $("#selectedAdvisor").html($(el).html());

        var curr = moment().add(2, 'days').startOf("isoWeek");

        $.get("/api/ajax/GetAdvisingAvailability/" + gStudentId + "/" + gAdvisorId + "/" + curr.format("MM-DD-YYYY"))
            .done(function (data) {
                $("#tabAppointmentContainer").html($.templates("#scheduleTmpl").render(data));
            })
            .fail(function (xhr, status, error) {
                alert("Request Failed: " + status + ", " + error);
            });
    }
</script>
}
