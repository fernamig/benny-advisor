@page "/Student/{studentId}/MakeAppointment"

<div class="alert alert-secondary">
    <h4 class="alert-heading">Schedule an Advising Appointment</h4>
    <hr />
    <ul class="nav navbar-nav dropdown-select">
        <li class="dropdown">
            <div class="dropdown-toggle caret-off p-2" data-toggle="dropdown">
                <span class="chevron-right fa fa-chevron-down"></span>
                <div id="selectedAdvisor" data-id="" class="">
                    <span>Choose an Advisor</span>
                    <span>&nbsp;</span>
                </div>
            </div>
            <div class="alert alert-secondary w-100 dropdown-menu">
                <div class="p-2 dropdown-select mb-1" data-id="100000001" onclick="selectAdvisor(this)">
                    <div>John Doe ~ College of Engineering ~ Specialty</div>
                    <div class="text-muted">20 minutes</div>
                </div>
                <div class="p-2 dropdown-select mb-1" data-id="100000001" onclick="selectAdvisor(this)">
                    <div>John Doe ~ College of Engineering ~ Specialty</div>
                    <div class="text-muted">20 minutes</div>
                </div>
            </div>
        </li>
    </ul>
</div>

<div id="tabAppointmentContainer">
</div>

<div id="spinnerContainer" class="d-none">
    <partial name="_Spinner" />
</div>

<partial name="_MakeAppointmentTmpl" />

<style>
    .dropdown-select {
        border: 1px solid #c0c0c0;
    }

    .dropdown-select:hover {
        border: 1px solid #a0a0a0;
        background-color: #d7d8db;
    }

    .dropdown-select .dropdown-toggle {
        height: 4em;
    }

    .chevron-right {
        top: 1.5em;
        position: relative;
        line-height: 0;
        margin-right: 6px;
        float: right;
    }

    .caret-off::before {
        display: none;
    }

    .caret-off::after {
        display: none;
    }
</style>

@section Scripts {
<script>
    $.views.settings.allowCode(true);
    gStudentId = '@ViewContext.RouteData.Values["studentId"]';

    function selectAdvisor(el)
    {
        $("#tabAppointmentContainer").html($("#spinnerContainer").html());

        gAdvisorId = $(el).attr("data-id");
        $("#selectedAdvisor").attr("data-id", gAdvisorId);
        $("#selectedAdvisor").html($(el).html());

        var curr = moment().add(2, 'days').startOf("isoWeek");

        $.get("/api/ajax/GetAdvisingAvailability/" + gStudentId + "/" + gAdvisorId + "/" + curr.format("MM-DD-YYYY"))
        .done(function(data) {
            $("#tabAppointmentContainer").html($.templates("#scheduleTmpl").render(data));
        })
        .fail(function(xhr, status, error) {
            alert("Request Failed: " + status + ", " + error);
        });
    }
</script>
}
